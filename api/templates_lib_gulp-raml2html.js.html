<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: templates/lib/gulp-raml2html.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: templates/lib/gulp-raml2html.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module gulpRaml2Html */
'use strict';
var through2 = require('through2');
var gutil = require('gulp-util');
var path = require('path');

// Taken from this gist: https://gist.github.com/iki/784ddd5ab33c1e1b726b
function gulpRaml2Html(options) {
  var raml2html = require('raml2html');

  var simplifyMark = function (mark) {
    if (mark) {
      mark.buffer = mark.buffer.split('\n', mark.line + 1)[mark.line].trim();
    }
  };

  if (!options) {
    options = {};
  }
  switch (options.type) {
  case 'json':
    options.config = {
      template: function (obj) {
        return JSON.stringify(obj, null, 2);
      }
    };
    break;
  case 'yaml':
    var yaml = require('js-yaml');
    options.config = {
      template: function (obj) {
        return yaml.safeDump(obj, {
          skipInvalid: true
        });
      }
    };
    break;
  default:
    options.type = 'html';
    if (!options.config) {
      options.config = raml2html.getDefaultConfig(options.mainTemplate, options.templatesPath);
    }
  }
  if (!options.extension) {
    options.extension = '.' + options.type;
  }

  var stream = through2.obj(function (file, enc, done) {
    var fail = function (message) {
      return done(new gutil.PluginError('raml2html', message));
    };

    if (file.isStream()) {
      return fail('Streams are not supported: ' + file.inspect());
    } else if (file.isNull()) {
      return fail('Input file is null: ' + file.inspect());
    } else if (!file.isBuffer()) {
      return fail('Expected a buffer: ' + file.inspect());
    }

    var cwd = process.cwd();
    process.chdir(path.resolve(path.dirname(file.path)));
    raml2html.render(file.contents, options.config).then(
      function (output) {
        process.chdir(cwd);
        stream.push(new gutil.File({
          base: file.base,
          cwd: file.cwd,
          path: gutil.replaceExtension(file.path, options.extension),
          contents: new Buffer(output)
        }));
        done();
      },
      function (error) {
        process.chdir(cwd);
        simplifyMark(error.context_mark);
        simplifyMark(error.problem_mark);
        process.nextTick(function () {
          fail(JSON.stringify(error, null, 2));
        });
      });
  });

  return stream;
}

/** Product HTML documentation for a RAML input file. */
module.exports = gulpRaml2Html;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-gulpDerefRamlSchema.html">gulpDerefRamlSchema</a></li><li><a href="module-gulpFixRamlOutput.html">gulpFixRamlOutput</a></li><li><a href="module-gulpJsonToRamlStruct.html">gulpJsonToRamlStruct</a></li><li><a href="module-gulpRaml2Html.html">gulpRaml2Html</a></li><li><a href="module-gulpRamlLint.html">gulpRamlLint</a></li><li><a href="module-gulpRamlParser.html">gulpRamlParser</a></li><li><a href="module-gulpValidateExamples.html">gulpValidateExamples</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#scanForRamlFile">scanForRamlFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Aug 26 2015 21:17:39 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
